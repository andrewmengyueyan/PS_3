<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>PS3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="PS3_files/libs/clipboard/clipboard.min.js"></script>
<script src="PS3_files/libs/quarto-html/quarto.js"></script>
<script src="PS3_files/libs/quarto-html/popper.min.js"></script>
<script src="PS3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="PS3_files/libs/quarto-html/anchor.min.js"></script>
<link href="PS3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="PS3_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="PS3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="PS3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="PS3_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">PS3</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>My github link is <a href="https://github.com/andrewmengyueyan/PS_3" class="uri">https://github.com/andrewmengyueyan/PS_3</a></p>
<section id="problem-1" class="level2">
<h2 class="anchored" data-anchor-id="problem-1">Problem 1</h2>
<p>Stata code and output</p>
<section id="a." class="level4">
<h4 class="anchored" data-anchor-id="a.">a.</h4>
<pre><code>. do "E:\study\Stat 506\PS3-Q1.do"
. import sasxport5 "E:\study\Stat 506\PS3-data\DEMO_D.XPT", clear

. save "E:\study\Stat 506\PS3-data\tempfile.dta", replace
(file E:\study\Stat 506\PS3-data\tempfile.dta not found)
file E:\study\Stat 506\PS3-data\tempfile.dta saved

. clear

. import sasxport5 "E:\study\Stat 506\PS3-data\VIX_D.XPT", clear

. merge 1:1 seqn using "E:\study\Stat 506\PS3-data\tempfile.dta", keep(matched)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             6,980  (_merge==3)
    -----------------------------------------

. drop _merge

. erase "E:\study\Stat 506\PS3-data\tempfile.dta"

. save "E:\study\Stat 506\PS3-data\MergedData.dta", replace
file E:\study\Stat 506\PS3-data\MergedData.dta saved

. count
  6,980</code></pre>
</section>
<section id="b." class="level4">
<h4 class="anchored" data-anchor-id="b.">b.</h4>
<pre><code>. summarize ridageyr

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    ridageyr |      6,980    37.87894    21.89424         12         85

. // I first inspect the descriptive statistics of the dataset, and find that the range of ridageyr is [12, 85], so I then make the partitions below.
. 
. egen age_group = cut(ridageyr), at(10, 20, 30, 40, 50, 60, 70, 80, 90) icodes    

. // I cut the ridageyr into partitions, and give each partition a label, for example, 12-19 is 0, 20-29 is 1, 30-39 is 2, 40-49 is 3, 50-59 is 4, 60-69 is 5, 70-79 is 6, 80-85 is 7.
. 
. // The original values in viq220 is not intuitive, I want to replace them with "Yes", "No", "Not Known"
. gen glasses_recoded_str = string(viq220) 

. replace glasses_recoded_str = "1 Yes" if glasses_recoded_str == "1"
variable glasses_recoded_str was str1 now str5
(2,765 real changes made)

. replace glasses_recoded_str = "2 No" if glasses_recoded_str == "2"
(3,780 real changes made)

. replace glasses_recoded_str = "9 Not Known" if glasses_recoded_str == "9"
variable glasses_recoded_str was str5 now str11
(2 real changes made)

. 
. // Generate the frequency table
. table (age_group) (glasses_recoded_str) if glasses_recoded_str != ".", statistic(proportion)

---------------------------------------------------
          |            glasses_recoded_str         
          |   1 Yes     2 No   9 Not Known    Total
----------+----------------------------------------
age_group |                                        
  0       |   .1023    .2166                  .3189
  1       |  .04674   .09638      .0003055    .1434
  2       |  .04109   .07347                  .1146
  3       |  .04368   .07439                  .1181
  4       |  .05117   .04185                 .09302
  5       |  .05987   .03635                 .09623
  6       |  .04567   .02261                 .06828
  7       |  .03177   .01573                  .0475
  Total   |   .4223    .5774      .0003055        1
---------------------------------------------------
In age_group, 0 represents 12-19, 1 represents 20-29, 2 represents 30-39, 3 represents 40-49, 4 represents 50-59, 5 represents 60-69, 6 represents 70-79, 7 represents 80-85. 
. The first column shows the proportion of respondents within each 10-year age bracket who wear glasses/contact lenses for distance vision
. </code></pre>
</section>
<section id="c." class="level4">
<h4 class="anchored" data-anchor-id="c.">c.&nbsp;</h4>
<pre><code>. // 1. First, we fit the logistic regression model between viq220 and age
. // I searched online and learned that when performing logistic regression in Stata, missing values are automatically ignored. Because I don't have to go out of my way to clean the data.
. // In logistic regression, the response should only have 2 classes. 9 indicates "Not Known", so I delete the observations having viq220 == 9.
. drop if viq220 == 9 
(2 observations deleted)

. // In logistic regression, the response usually has value 0 and 1, otherwise it will not work normally. So I replace viq220 == 2 with viq220 == 0. Then 1 indicates that the respondent wear glasses or contact lenses for distance vision, and 0 indicates the opposite.
. replace viq220 = 0 if viq220 == 2 
(3,780 real changes made)

. 
. logistic viq220 ridageyr
. estat ic

Logistic regression                                     Number of obs =  6,545
                                                        LR chi2(1)    = 443.37
                                                        Prob &gt; chi2   = 0.0000
Log likelihood = -4235.9433                             Pseudo R2     = 0.0497

------------------------------------------------------------------------------
      viq220 | Odds ratio   Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    ridageyr |    1.02498   .0012356    20.47   0.000     1.022561    1.027405
       _cons |    .283379   .0151461   -23.59   0.000     .2551952    .3146755
-----------------------------------------------------------------------------
       Model |          N   ll(null)  ll(model)      df        AIC        BIC
-------------+---------------------------------------------------------------
           . |      6,545  -4457.627  -4235.943       2   8475.887    8489.46
-----------------------------------------------------------------------------
Note: BIC uses N = number of observations. See [R] IC note.

. 
.
. // 2. Secondly, we fit the logistic regression between viq220 and age, race and gender.
. logistic viq220 ridageyr ridreth1 i.riagendr
. estat ic

Logistic regression                                     Number of obs =  6,545
                                                        LR chi2(3)    = 564.76
                                                        Prob &gt; chi2   = 0.0000
Log likelihood = -4175.2478                             Pseudo R2     = 0.0633

------------------------------------------------------------------------------
      viq220 | Odds ratio   Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    ridageyr |   1.025324   .0012549    20.43   0.000     1.022867    1.027786
    ridreth1 |    1.13275   .0254723     5.54   0.000     1.083909    1.183791
  2.riagendr |   1.645628   .0866472     9.46   0.000     1.484271    1.824526
       _cons |   .1511379   .0134607   -21.22   0.000     .1269297    .1799632
------------------------------------------------------------------------------

       Model |          N   ll(null)  ll(model)      df        AIC        BIC
-------------+---------------------------------------------------------------
           . |      6,545  -4457.627  -4175.248       4   8358.496   8385.641
-----------------------------------------------------------------------------
Note: BIC uses N = number of observations. See [R] IC note.

. 
.
. // 3. Thirdly, we fit the logistic regression model between viq220, race, gender and Poverty Income Ratio
. logistic viq220 ridageyr ridreth1 riagendr indfmpir
. estat ic

Logistic regression                                     Number of obs =  6,247
                                                        LR chi2(4)    = 588.32
                                                        Prob &gt; chi2   = 0.0000
Log likelihood = -3965.3948                             Pseudo R2     = 0.0691

------------------------------------------------------------------------------
      viq220 | Odds ratio   Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
    ridageyr |   1.024047   .0012924    18.83   0.000     1.021517    1.026583
    ridreth1 |   1.097216   .0258548     3.94   0.000     1.047693    1.149079
    riagendr |   1.679667   .0909057     9.58   0.000     1.510619    1.867631
    indfmpir |    1.15327    .019618     8.38   0.000     1.115453    1.192368
       _cons |   .0717786   .0092205   -20.51   0.000     .0558023    .0923289
-----------------------------------------------------------------------------
       Model |          N   ll(null)  ll(model)      df        AIC        BIC
-------------+---------------------------------------------------------------
           . |      6,247  -4259.553  -3965.395       5    7940.79   7974.489
-----------------------------------------------------------------------------
Note: BIC uses N = number of observations. See [R] IC note.

. </code></pre>
</section>
<section id="d." class="level4">
<h4 class="anchored" data-anchor-id="d.">d.&nbsp;</h4>
<pre><code>. // Discussion: From the third model in part c, the odds of men and women being wears of glasess/contact lenses for distance vision is 1.679667, which means that the probability that men being wears of glasses/contact lenses for distance is 1.679667 times of women. 
. 
. // Test: We use hypothesis test to test whether the proportion of wearers of glasses/contact lenses for distance vision differs between men and women. Let the prop(1) be the proportion of men wearing glasess/contact lenses and prop(2) be the proportion of women doing that. Diff is the difference between prop(1) and prop(2), that is diff = prop(1) - prop(2). H0: diff = 0, Ha: diff != 0.
. 
. prtest viq220, by(riagendr)

Two-sample test of proportions                     1: Number of obs =     3195
                                                   2: Number of obs =     3350
------------------------------------------------------------------------------
       Group |       Mean   Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           1 |   .3696401   .0085398                      .3529023    .3863778
           2 |   .4728358   .0086259                      .4559293    .4897423
-------------+----------------------------------------------------------------
        diff |  -.1031958   .0121382                     -.1269861   -.0794054
             |  under H0:   .0122146    -8.45   0.000
------------------------------------------------------------------------------
        diff = prop(1) - prop(2)                                  z =  -8.4485
    H0: diff = 0

    Ha: diff &lt; 0                 Ha: diff != 0                 Ha: diff &gt; 0
 Pr(Z &lt; z) = 0.0000         Pr(|Z| &gt; |z|) = 0.0000          Pr(Z &gt; z) = 1.0000

. 
. // The result is that p-value is 0.000, which means we can reject the null hypothesis. So we conclude that the proportion of men and women wearing glasses is significantly different. 
. 
end of do-file</code></pre>
</section>
</section>
<section id="problem-2" class="level2">
<h2 class="anchored" data-anchor-id="problem-2">Problem 2</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RSQLite)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>sakila <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), <span class="st">"E:/study/Stat 506/PS3-data/sakila_master.db"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>sakila</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQLiteConnection&gt;
  Path: E:\study\Stat 506\PS3-data\sakila_master.db
  Extensions: TRUE</code></pre>
</div>
</div>
<section id="a.-1" class="level4">
<h4 class="anchored" data-anchor-id="a.-1">a.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(sakila, <span class="st">"select * from language"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  language_id     name         last_update
1           1  English 2020-12-23 07:12:12
2           2  Italian 2020-12-23 07:12:12
3           3 Japanese 2020-12-23 07:12:12
4           4 Mandarin 2020-12-23 07:12:12
5           5   French 2020-12-23 07:12:12
6           6   German 2020-12-23 07:12:12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(sakila, <span class="st">"select l.name, count(*) as count_language</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="st">from film as f</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="st">left join language as l on f.language_id = l.language_id</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="st">group by l.name</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="st">           "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     name count_language
1 English           1000</code></pre>
</div>
</div>
</section>
<section id="b.-1" class="level4">
<h4 class="anchored" data-anchor-id="b.-1">b.</h4>
<section id="use-sql-query-or-queries-to-extract-the-appropriate-tables-then-use-regular-r-to-answer-the-question" class="level5">
<h5 class="anchored" data-anchor-id="use-sql-query-or-queries-to-extract-the-appropriate-tables-then-use-regular-r-to-answer-the-question">1. Use SQL query or queries to extract the appropriate table(s), then use regular R to answer the question:</h5>
</section>
<section id="sql-part" class="level5">
<h5 class="anchored" data-anchor-id="sql-part">SQL part</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df_1 <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(sakila, <span class="st">"select c.film_id as film_id, f.title as film_title, c.category_id as category_id, n.name as genre </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="st">           from film_category as c </span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="st">           left join film as f on c.film_id = f.film_id </span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="st">           left join category as n on c.category_id = n.category_id"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  film_id       film_title category_id       genre
1       1 ACADEMY DINOSAUR           6 Documentary
2       2   ACE GOLDFINGER          11      Horror
3       3 ADAPTATION HOLES           6 Documentary
4       4 AFFAIR PREJUDICE          11      Horror
5       5      AFRICAN EGG           8      Family
6       6     AGENT TRUMAN           9     Foreign</code></pre>
</div>
</div>
</section>
<section id="r-part" class="level5">
<h5 class="anchored" data-anchor-id="r-part">R part</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>genre_freq <span class="ot">&lt;-</span> <span class="fu">table</span>(df_1<span class="sc">$</span>genre)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>max_genre_index <span class="ot">&lt;-</span> <span class="fu">which.max</span>(genre_freq)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>genre_freq[max_genre_index]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sports 
    74 </code></pre>
</div>
</div>
<p>Sports movie is the most common genre; 74 movies are of sports genre.</p>
</section>
<section id="use-a-single-sql-query-to-answer-the-question" class="level5">
<h5 class="anchored" data-anchor-id="use-a-single-sql-query-to-answer-the-question">2. Use a single SQL query to answer the question:</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(sakila, <span class="st">"select m.genre, count (*) as genre_count </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="st">from (select c.film_id as film_id, f.title as film_title, c.category_id as category_id, n.name as genre </span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="st">           from film_category as c </span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="st">           left join film as f on c.film_id = f.film_id </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="st">           left join category as n on c.category_id = n.category_id) as m</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="st">           group by m.genre</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="st">           order by - genre_count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         genre genre_count
1       Sports          74
2      Foreign          73
3       Family          69
4  Documentary          68
5    Animation          66
6       Action          64
7          New          63
8        Drama          62
9        Games          61
10      Sci-Fi          61
11    Children          60
12      Comedy          58
13    Classics          57
14      Travel          57
15      Horror          56
16       Music          51</code></pre>
</div>
</div>
<p>It can be seen that Sports movie is the most common genre; 74 movies are of sports genre.</p>
</section>
</section>
<section id="c.-1" class="level4">
<h4 class="anchored" data-anchor-id="c.-1">c.</h4>
<section id="use-sql-query-or-queries-to-extract-the-appropriate-tables-then-use-regular-r-to-answer-the-question-1" class="level5">
<h5 class="anchored" data-anchor-id="use-sql-query-or-queries-to-extract-the-appropriate-tables-then-use-regular-r-to-answer-the-question-1">1. Use SQL query or queries to extract the appropriate table(s), then use regular R to answer the question:</h5>
</section>
<section id="sql-part-1" class="level5">
<h5 class="anchored" data-anchor-id="sql-part-1">SQL part</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df_2 <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(sakila, <span class="st">"select new.country, count(*) as country_count from </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="st">(select cu.customer_id, cu.address_id, ad.city_id, ci.city, co.country from </span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="st">           customer as cu</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="st">           left join address as ad on cu.address_id = ad.address_id</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="st">           left join city as ci on ad.city_id = ci.city_id</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="st">           left join country as co on ci.country_id = co.country_id) as new</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="st">           group by new.country"</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         country country_count
1    Afghanistan             1
2        Algeria             3
3 American Samoa             1
4         Angola             2
5       Anguilla             1
6      Argentina            13</code></pre>
</div>
</div>
</section>
<section id="r-part-1" class="level5">
<h5 class="anchored" data-anchor-id="r-part-1">R part</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>country_with_9_Customers_index <span class="ot">&lt;-</span> <span class="fu">which</span>(df_2<span class="sc">$</span>country_count <span class="sc">==</span> <span class="dv">9</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>df_2[country_with_9_Customers_index,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           country country_count
101 United Kingdom             9</code></pre>
</div>
</div>
<p>The United Kingdom is the only country that has exactly 9 customers.</p>
</section>
<section id="use-a-single-sql-query-to-answer-the-question-1" class="level5">
<h5 class="anchored" data-anchor-id="use-a-single-sql-query-to-answer-the-question-1">2. Use a single SQL query to answer the question:</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(sakila, <span class="st">"select new.country, count(*) as country_count from </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="st">(select cu.customer_id, cu.address_id, ad.city_id, ci.city, co.country from </span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="st">           customer as cu</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="st">           left join address as ad on cu.address_id = ad.address_id</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="st">           left join city as ci on ad.city_id = ci.city_id</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="st">           left join country as co on ci.country_id = co.country_id) as new</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="st">           group by new.country</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="st">           having country_count = 9"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         country country_count
1 United Kingdom             9</code></pre>
</div>
</div>
<p>The United Kingdom is the only country that has exactly 9 customers.</p>
</section>
</section>
</section>
<section id="problem-3" class="level2">
<h2 class="anchored" data-anchor-id="problem-3">Problem 3</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>us500 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"E:/study/Stat 506/PS3-data/us-500.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="a.-2" class="level4">
<h4 class="anchored" data-anchor-id="a.-2">a.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>TLD_net <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">grepl</span>(<span class="st">".net"</span>, us500<span class="sc">$</span>email))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>TLD <span class="ot">&lt;-</span> <span class="fu">nrow</span>(us500)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>TLD_net_prop <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, <span class="fu">paste</span>((TLD_net<span class="sc">/</span>TLD)<span class="sc">*</span><span class="dv">100</span>, <span class="st">"%"</span>, <span class="at">collapse =</span> <span class="st">""</span>))</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(TLD_net_prop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "14.6%"</code></pre>
</div>
</div>
</section>
<section id="b.-2" class="level4">
<h4 class="anchored" data-anchor-id="b.-2">b.</h4>
<p>First I want to detect how many non-alphanumeric characters are in the “<span class="citation" data-cites="domain">@domain</span>”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>email <span class="ot">&lt;-</span> us500<span class="sc">$</span>email</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>count_non_alphanum <span class="ot">&lt;-</span> <span class="cf">function</span>(email) {</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  domain <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(email, <span class="st">"@(.*)"</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  non_alnum_count <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">str_count</span>(domain, <span class="st">"[^A-Za-z0-9]"</span>))</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(non_alnum_count)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>non_alnum_counts <span class="ot">&lt;-</span> <span class="fu">sapply</span>(email, count_non_alphanum)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(non_alnum_counts <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">==</span> <span class="fu">length</span>(email)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>The results show that in the domain, there are no other non-alphanumeric characters except “.”. So we can just count the number of usernames that have a non-alphanumeric character(s).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>usernames <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">strsplit</span>(us500<span class="sc">$</span>email, <span class="st">"@"</span>), <span class="st">"[["</span>, <span class="dv">1</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>contains_non_alphanumeric <span class="ot">&lt;-</span> <span class="fu">grepl</span>(<span class="st">"[^A-Za-z0-9]"</span>, usernames)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>proportion_with_non_alphanumeric <span class="ot">&lt;-</span> <span class="fu">mean</span>(contains_non_alphanumeric)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, <span class="fu">paste</span>(proportion_with_non_alphanumeric<span class="sc">*</span><span class="dv">100</span>, <span class="st">"%"</span>, <span class="at">collapse =</span> <span class="st">""</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "50.6%"</code></pre>
</div>
</div>
</section>
<section id="c.-2" class="level4">
<h4 class="anchored" data-anchor-id="c.-2">c.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>all_area_codes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">substr</span>(us500<span class="sc">$</span>phone1, <span class="dv">1</span>, <span class="dv">3</span>), <span class="fu">substr</span>(us500<span class="sc">$</span>phone2, <span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>area_code_counts <span class="ot">&lt;-</span> <span class="fu">table</span>(all_area_codes)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>max_count <span class="ot">&lt;-</span> <span class="fu">max</span>(area_code_counts)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>most_frequent_area_codes <span class="ot">&lt;-</span> <span class="fu">names</span>(area_code_counts[area_code_counts <span class="sc">==</span> max_count])</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"The most common area code is"</span>, most_frequent_area_codes, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The most common area code is 973 </code></pre>
</div>
</div>
<p>Because there are two columns of phone numbers, so I merged them first. But I found that the area code of the same observation are the same for every observation.</p>
<p>The most common area code is 973.</p>
</section>
<section id="d.-1" class="level4">
<h4 class="anchored" data-anchor-id="d.-1">d.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>us500<span class="sc">$</span>ApartmentNumber <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">".*#(</span><span class="sc">\\</span><span class="st">d+).*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, us500<span class="sc">$</span>address)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>us500<span class="sc">$</span>ApartmentNumber <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(us500<span class="sc">$</span>ApartmentNumber)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>log_apartment_numbers <span class="ot">&lt;-</span> <span class="fu">log</span>(us500<span class="sc">$</span>ApartmentNumber[<span class="sc">!</span><span class="fu">is.na</span>(us500<span class="sc">$</span>ApartmentNumber)])</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(log_apartment_numbers, <span class="at">main =</span> <span class="st">"Log of Apartment Numbers"</span>, <span class="at">xlab =</span> <span class="st">"Log(Apartment Number)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="PS3_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="e." class="level4">
<h4 class="anchored" data-anchor-id="e.">e.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>leading_digit_ap <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(<span class="fu">na.omit</span>(us500<span class="sc">$</span>ApartmentNumber), <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(leading_digit_ap, <span class="at">main =</span> <span class="st">"Leading Digits of Apartment Numbers"</span>, <span class="at">xlab =</span> <span class="st">"Leading Digits"</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(leading_digit_ap)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>benford_prob <span class="ot">&lt;-</span> <span class="fu">log10</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>))</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>benford_leading_num <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> benford_prob)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(benford_leading_num, <span class="at">main =</span> <span class="st">"Benford Leading Numbers"</span>, <span class="at">xlab =</span> <span class="st">"Numbers"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="PS3_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From the histogram of the leading digits of apartment numbers, I conclude that they do not obey the Benford’s rule, compared with the histogram of numbers which follow Benford’s law.</p>
</section>
<section id="f." class="level4">
<h4 class="anchored" data-anchor-id="f.">f.</h4>
<p>From the Wikipedia link given by the professor, I found that the further back a digit is in an array, the more likely it is that it is any number from 0 to 9, which is uniformly distributed, which is the generalization to digits beyond the first one.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>us500<span class="sc">$</span>street_number <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">" .*"</span>, <span class="st">""</span>, <span class="fu">na.omit</span>(us500<span class="sc">$</span>address)))</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>last_digit_st <span class="ot">&lt;-</span> us500<span class="sc">$</span>street_number<span class="sc">%%</span><span class="dv">10</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(last_digit_st, <span class="at">main =</span> <span class="st">"Last Digits of Street Numbers"</span>, <span class="at">xlab =</span> <span class="st">"Last Digits"</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">length</span>(last_digit_st)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>benford_last_num <span class="ot">&lt;-</span> <span class="fu">runif</span>(m, <span class="dv">0</span>, <span class="dv">9</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(benford_last_num, <span class="at">main =</span> <span class="st">"Benford Numbers"</span>, <span class="at">xlab =</span> <span class="st">"Last Numbers"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="PS3_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is the generalization of Benford’s first digit law. Actually, the last digits don’t obey Benford’s first digit law because they seem to follow the Uniform Distribution, while the uniform distribution doesn’t obey Benford’s law. By comparing the histogram of the last digit of the street number with the histogram of the same number of uniformly distributed 0-9, I found that the shapes of the two histograms are very similar, so I concluded that the last digit of the street number follows the generalization to digits beyond the first digit but don’t obey Benford’s law itself.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>